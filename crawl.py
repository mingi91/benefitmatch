import requests
import json
import re
from tqdm import tqdm
import gzip

API_KEY = "ZuK00g5OQwrnp8WTkgktU3rkw62gi5qKb0AkBmz8A16xGhov1WqDbbvOaIx10Sa3kBUqdS9hAEJJ8IS3sTpbgA=="
BASE_URL = "https://api.odcloud.kr/api/gov24/v3"

# ---------------- fetch_all_data ----------------
def fetch_all_data(endpoint):
    all_data = []
    page = 1
    per_page = 1000
    while True:
        url = f"{BASE_URL}/{endpoint}?page={page}&perPage={per_page}&serviceKey={API_KEY}"
        response = requests.get(url)
        if response.status_code != 200:
            print(f"âŒ {endpoint} ì˜¤ë¥˜: {response.status_code}")
            break
        data = response.json()
        if "data" not in data or not data["data"]:
            break
        all_data.extend(data["data"])
        if len(data["data"]) < per_page:
            break
        page += 1
    return all_data

# ---------------- REGION_KEYWORDS ----------------
REGION_KEYWORDS = {
    # ê´‘ì—­ì‹œÂ·ë„
    "ì„œìš¸": "ì„œìš¸", "ë¶€ì‚°": "ë¶€ì‚°", "ëŒ€êµ¬": "ëŒ€êµ¬", "ì¸ì²œ": "ì¸ì²œ",
    "ê´‘ì£¼": "ê´‘ì£¼", "ëŒ€ì „": "ëŒ€ì „", "ìš¸ì‚°": "ìš¸ì‚°", "ì„¸ì¢…": "ì„¸ì¢…",
    "ê²½ê¸°": "ê²½ê¸°", "ê°•ì›": "ê°•ì›", "ì¶©ë¶": "ì¶©ë¶", "ì¶©ì²­ë¶ë„": "ì¶©ë¶",
    "ì¶©ë‚¨": "ì¶©ë‚¨", "ì¶©ì²­ë‚¨ë„": "ì¶©ë‚¨", "ì „ë¶": "ì „ë¶", "ì „ë¼ë¶ë„": "ì „ë¶",
    "ì „ë‚¨": "ì „ë‚¨", "ì „ë¼ë‚¨ë„": "ì „ë‚¨", "ê²½ë¶": "ê²½ë¶", "ê²½ìƒë¶ë„": "ê²½ë¶",
    "ê²½ë‚¨": "ê²½ë‚¨", "ê²½ìƒë‚¨ë„": "ê²½ë‚¨", "ì œì£¼": "ì œì£¼",

    # ê²½ê¸°ë„
    "ìˆ˜ì›ì‹œ": "ê²½ê¸°","ìˆ˜ì›": "ê²½ê¸°","ì„±ë‚¨ì‹œ": "ê²½ê¸°","ì„±ë‚¨": "ê²½ê¸°","ê³ ì–‘ì‹œ": "ê²½ê¸°","ê³ ì–‘": "ê²½ê¸°","ìš©ì¸ì‹œ": "ê²½ê¸°","ìš©ì¸": "ê²½ê¸°","ë¶€ì²œì‹œ": "ê²½ê¸°","ë¶€ì²œ": "ê²½ê¸°","ì•ˆì‚°ì‹œ": "ê²½ê¸°","ì•ˆì‚°": "ê²½ê¸°",
    "ì•ˆì–‘ì‹œ": "ê²½ê¸°","ì•ˆì–‘": "ê²½ê¸°","ë‚¨ì–‘ì£¼ì‹œ": "ê²½ê¸°","ë‚¨ì–‘ì£¼": "ê²½ê¸°","í™”ì„±ì‹œ": "ê²½ê¸°","í™”ì„±": "ê²½ê¸°","í‰íƒì‹œ": "ê²½ê¸°","í‰íƒ": "ê²½ê¸°","ì˜ì •ë¶€ì‹œ": "ê²½ê¸°","ì˜ì •ë¶€": "ê²½ê¸°","ì‹œí¥ì‹œ": "ê²½ê¸°","ì‹œí¥": "ê²½ê¸°",
    "íŒŒì£¼ì‹œ": "ê²½ê¸°","íŒŒì£¼": "ê²½ê¸°","ê¹€í¬ì‹œ": "ê²½ê¸°","ê¹€í¬": "ê²½ê¸°","ê´‘ëª…ì‹œ": "ê²½ê¸°","ê´‘ëª…": "ê²½ê¸°","ê´‘ì£¼ì‹œ": "ê²½ê¸°","ê´‘ì£¼": "ê²½ê¸°","êµ°í¬ì‹œ": "ê²½ê¸°","êµ°í¬": "ê²½ê¸°","ì´ì²œì‹œ": "ê²½ê¸°","ì´ì²œ": "ê²½ê¸°",
    "ì˜¤ì‚°ì‹œ": "ê²½ê¸°","ì˜¤ì‚°": "ê²½ê¸°","ì–‘ì£¼ì‹œ": "ê²½ê¸°","ì–‘ì£¼": "ê²½ê¸°","êµ¬ë¦¬ì‹œ": "ê²½ê¸°","êµ¬ë¦¬": "ê²½ê¸°","ì•ˆì„±ì‹œ": "ê²½ê¸°","ì•ˆì„±": "ê²½ê¸°","í¬ì²œì‹œ": "ê²½ê¸°","í¬ì²œ": "ê²½ê¸°","ì˜ì™•ì‹œ": "ê²½ê¸°","ì˜ì™•": "ê²½ê¸°",
    "í•˜ë‚¨ì‹œ": "ê²½ê¸°","í•˜ë‚¨": "ê²½ê¸°","ì—¬ì£¼ì‹œ": "ê²½ê¸°","ì—¬ì£¼": "ê²½ê¸°","ì–‘í‰êµ°": "ê²½ê¸°","ì–‘í‰": "ê²½ê¸°","ê°€í‰êµ°": "ê²½ê¸°","ê°€í‰": "ê²½ê¸°","ì—°ì²œêµ°": "ê²½ê¸°","ì—°ì²œ": "ê²½ê¸°",

    # ê°•ì›ë„
    "ì¶˜ì²œì‹œ": "ê°•ì›","ì¶˜ì²œ": "ê°•ì›","ì›ì£¼ì‹œ": "ê°•ì›","ì›ì£¼": "ê°•ì›","ê°•ë¦‰ì‹œ": "ê°•ì›","ê°•ë¦‰": "ê°•ì›","ë™í•´ì‹œ": "ê°•ì›","ë™í•´": "ê°•ì›","íƒœë°±ì‹œ": "ê°•ì›","íƒœë°±": "ê°•ì›","ì†ì´ˆì‹œ": "ê°•ì›","ì†ì´ˆ": "ê°•ì›",
    "ì‚¼ì²™ì‹œ": "ê°•ì›","ì‚¼ì²™": "ê°•ì›","í™ì²œêµ°": "ê°•ì›","í™ì²œ": "ê°•ì›","íš¡ì„±êµ°": "ê°•ì›","íš¡ì„±": "ê°•ì›","ì˜ì›”êµ°": "ê°•ì›","ì˜ì›”": "ê°•ì›","í‰ì°½êµ°": "ê°•ì›","í‰ì°½": "ê°•ì›","ì •ì„ êµ°": "ê°•ì›","ì •ì„ ": "ê°•ì›",
    "ì² ì›êµ°": "ê°•ì›","ì² ì›": "ê°•ì›","í™”ì²œêµ°": "ê°•ì›","í™”ì²œ": "ê°•ì›","ì–‘êµ¬êµ°": "ê°•ì›","ì–‘êµ¬": "ê°•ì›","ì¸ì œêµ°": "ê°•ì›","ì¸ì œ": "ê°•ì›","ê³ ì„±êµ°": "ê°•ì›","ê³ ì„±": "ê°•ì›","ì–‘ì–‘êµ°": "ê°•ì›","ì–‘ì–‘": "ê°•ì›",

    # ì¶©ì²­ë¶ë„
    "ì²­ì£¼ì‹œ": "ì¶©ë¶","ì²­ì£¼": "ì¶©ë¶","ì¶©ì£¼ì‹œ": "ì¶©ë¶","ì¶©ì£¼": "ì¶©ë¶","ì œì²œì‹œ": "ì¶©ë¶","ì œì²œ": "ì¶©ë¶","ë³´ì€êµ°": "ì¶©ë¶","ë³´ì€": "ì¶©ë¶","ì˜¥ì²œêµ°": "ì¶©ë¶","ì˜¥ì²œ": "ì¶©ë¶","ì˜ë™êµ°": "ì¶©ë¶","ì˜ë™": "ì¶©ë¶",
    "ì§„ì²œêµ°": "ì¶©ë¶","ì§„ì²œ": "ì¶©ë¶","ê´´ì‚°êµ°": "ì¶©ë¶","ê´´ì‚°": "ì¶©ë¶","ìŒì„±êµ°": "ì¶©ë¶","ìŒì„±": "ì¶©ë¶","ë‹¨ì–‘êµ°": "ì¶©ë¶","ë‹¨ì–‘": "ì¶©ë¶",

    # ì¶©ì²­ë‚¨ë„
    "ì²œì•ˆì‹œ": "ì¶©ë‚¨","ì²œì•ˆ": "ì¶©ë‚¨","ê³µì£¼ì‹œ": "ì¶©ë‚¨","ê³µì£¼": "ì¶©ë‚¨","ë³´ë ¹ì‹œ": "ì¶©ë‚¨","ë³´ë ¹": "ì¶©ë‚¨","ì•„ì‚°ì‹œ": "ì¶©ë‚¨","ì•„ì‚°": "ì¶©ë‚¨","ì„œì‚°ì‹œ": "ì¶©ë‚¨","ì„œì‚°": "ì¶©ë‚¨","ë…¼ì‚°ì‹œ": "ì¶©ë‚¨","ë…¼ì‚°": "ì¶©ë‚¨",
    "ê³„ë£¡ì‹œ": "ì¶©ë‚¨","ê³„ë£¡": "ì¶©ë‚¨","ë‹¹ì§„ì‹œ": "ì¶©ë‚¨","ë‹¹ì§„": "ì¶©ë‚¨","ê¸ˆì‚°êµ°": "ì¶©ë‚¨","ê¸ˆì‚°": "ì¶©ë‚¨","ë¶€ì—¬êµ°": "ì¶©ë‚¨","ë¶€ì—¬": "ì¶©ë‚¨","ì„œì²œêµ°": "ì¶©ë‚¨","ì„œì²œ": "ì¶©ë‚¨","ì²­ì–‘êµ°": "ì¶©ë‚¨","ì²­ì–‘": "ì¶©ë‚¨",
    "í™ì„±êµ°": "ì¶©ë‚¨","í™ì„±": "ì¶©ë‚¨","ì˜ˆì‚°êµ°": "ì¶©ë‚¨","ì˜ˆì‚°": "ì¶©ë‚¨","íƒœì•ˆêµ°": "ì¶©ë‚¨","íƒœì•ˆ": "ì¶©ë‚¨",

    # ì „ë¼ë¶ë„
    "ì „ì£¼ì‹œ": "ì „ë¶","ì „ì£¼": "ì „ë¶","êµ°ì‚°ì‹œ": "ì „ë¶","êµ°ì‚°": "ì „ë¶","ìµì‚°ì‹œ": "ì „ë¶","ìµì‚°": "ì „ë¶","ì •ìì‹œ": "ì „ë¶","ì •ì": "ì „ë¶","ë‚¨ì›ì‹œ": "ì „ë¶","ë‚¨ì›": "ì „ë¶","ê¹€ì œì‹œ": "ì „ë¶","ê¹€ì œ": "ì „ë¶",
    "ì™„ì£¼êµ°": "ì „ë¶","ì™„ì£¼": "ì „ë¶","ì§„ì•ˆêµ°": "ì „ë¶","ì§„ì•ˆ": "ì „ë¶","ë¬´ì£¼êµ°": "ì „ë¶","ë¬´ì£¼": "ì „ë¶","ì¥ìˆ˜êµ°": "ì „ë¶","ì¥ìˆ˜": "ì „ë¶","ì„ì‹¤êµ°": "ì „ë¶","ì„ì‹¤": "ì „ë¶","ìˆœì°½êµ°": "ì „ë¶","ìˆœì°½": "ì „ë¶",
    "ê³ ì°½êµ°": "ì „ë¶","ê³ ì°½": "ì „ë¶","ë¶€ì•ˆêµ°": "ì „ë¶","ë¶€ì•ˆ": "ì „ë¶",

    # ì „ë¼ë‚¨ë„
    "ëª©í¬ì‹œ": "ì „ë‚¨","ëª©í¬": "ì „ë‚¨","ì—¬ìˆ˜ì‹œ": "ì „ë‚¨","ì—¬ìˆ˜": "ì „ë‚¨","ìˆœì²œì‹œ": "ì „ë‚¨","ìˆœì²œ": "ì „ë‚¨","ë‚˜ì£¼ì‹œ": "ì „ë‚¨","ë‚˜ì£¼": "ì „ë‚¨","ê´‘ì–‘ì‹œ": "ì „ë‚¨","ê´‘ì–‘": "ì „ë‚¨","ë‹´ì–‘êµ°": "ì „ë‚¨","ë‹´ì–‘": "ì „ë‚¨",
    "ê³¡ì„±êµ°": "ì „ë‚¨","ê³¡ì„±": "ì „ë‚¨","êµ¬ë¡€êµ°": "ì „ë‚¨","êµ¬ë¡€": "ì „ë‚¨","ê³ í¥êµ°": "ì „ë‚¨","ê³ í¥": "ì „ë‚¨","ë³´ì„±êµ°": "ì „ë‚¨","ë³´ì„±": "ì „ë‚¨","í™”ìˆœêµ°": "ì „ë‚¨","í™”ìˆœ": "ì „ë‚¨","ì¥í¥êµ°": "ì „ë‚¨","ì¥í¥": "ì „ë‚¨",
    "ê°•ì§„êµ°": "ì „ë‚¨","ê°•ì§„": "ì „ë‚¨","í•´ë‚¨êµ°": "ì „ë‚¨","í•´ë‚¨": "ì „ë‚¨","ì˜ì•”êµ°": "ì „ë‚¨","ì˜ì•”": "ì „ë‚¨","ë¬´ì•ˆêµ°": "ì „ë‚¨","ë¬´ì•ˆ": "ì „ë‚¨","í•¨í‰êµ°": "ì „ë‚¨","í•¨í‰": "ì „ë‚¨","ì˜ê´‘êµ°": "ì „ë‚¨","ì˜ê´‘": "ì „ë‚¨",
    "ì¥ì„±êµ°": "ì „ë‚¨","ì¥ì„±": "ì „ë‚¨","ì™„ë„êµ°": "ì „ë‚¨","ì™„ë„": "ì „ë‚¨","ì§„ë„êµ°": "ì „ë‚¨","ì§„ë„": "ì „ë‚¨","ì‹ ì•ˆêµ°": "ì „ë‚¨","ì‹ ì•ˆ": "ì „ë‚¨",

    # ê²½ìƒë¶ë„
    "í¬í•­ì‹œ": "ê²½ë¶","í¬í•­": "ê²½ë¶","ê²½ì£¼ì‹œ": "ê²½ë¶","ê²½ì£¼": "ê²½ë¶","ê¹€ì²œì‹œ": "ê²½ë¶","ê¹€ì²œ": "ê²½ë¶","ì•ˆë™ì‹œ": "ê²½ë¶","ì•ˆë™": "ê²½ë¶","êµ¬ë¯¸ì‹œ": "ê²½ë¶","êµ¬ë¯¸": "ê²½ë¶","ì˜ì£¼ì‹œ": "ê²½ë¶","ì˜ì£¼": "ê²½ë¶",
    "ì˜ì²œì‹œ": "ê²½ë¶","ì˜ì²œ": "ê²½ë¶","ìƒì£¼ì‹œ": "ê²½ë¶","ìƒì£¼": "ê²½ë¶","ë¬¸ê²½ì‹œ": "ê²½ë¶","ë¬¸ê²½": "ê²½ë¶","ê²½ì‚°ì‹œ": "ê²½ë¶","ê²½ì‚°": "ê²½ë¶","êµ°ìœ„êµ°": "ê²½ë¶","êµ°ìœ„": "ê²½ë¶","ì˜ì„±êµ°": "ê²½ë¶","ì˜ì„±": "ê²½ë¶",
    "ì²­ì†¡êµ°": "ê²½ë¶","ì²­ì†¡": "ê²½ë¶","ì˜ì–‘êµ°": "ê²½ë¶","ì˜ì–‘": "ê²½ë¶","ì˜ë•êµ°": "ê²½ë¶","ì˜ë•": "ê²½ë¶","ì²­ë„êµ°": "ê²½ë¶","ì²­ë„": "ê²½ë¶","ê³ ë ¹êµ°": "ê²½ë¶","ê³ ë ¹": "ê²½ë¶","ì„±ì£¼êµ°": "ê²½ë¶","ì„±ì£¼": "ê²½ë¶",
    "ì¹ ê³¡êµ°": "ê²½ë¶","ì¹ ê³¡": "ê²½ë¶","ì˜ˆì²œêµ°": "ê²½ë¶","ì˜ˆì²œ": "ê²½ë¶","ë´‰í™”êµ°": "ê²½ë¶","ë´‰í™”": "ê²½ë¶","ìš¸ì§„êµ°": "ê²½ë¶","ìš¸ì§„": "ê²½ë¶","ìš¸ë¦‰êµ°": "ê²½ë¶","ìš¸ë¦‰": "ê²½ë¶",

    # ê²½ìƒë‚¨ë„
    "ì°½ì›ì‹œ": "ê²½ë‚¨","ì°½ì›": "ê²½ë‚¨","ì§„ì£¼ì‹œ": "ê²½ë‚¨","ì§„ì£¼": "ê²½ë‚¨","í†µì˜ì‹œ": "ê²½ë‚¨","í†µì˜": "ê²½ë‚¨","ì‚¬ì²œì‹œ": "ê²½ë‚¨","ì‚¬ì²œ": "ê²½ë‚¨","ê¹€í•´ì‹œ": "ê²½ë‚¨","ê¹€í•´": "ê²½ë‚¨","ë°€ì–‘ì‹œ": "ê²½ë‚¨","ë°€ì–‘": "ê²½ë‚¨",
    "ê±°ì œì‹œ": "ê²½ë‚¨","ê±°ì œ": "ê²½ë‚¨","ì–‘ì‚°ì‹œ": "ê²½ë‚¨","ì–‘ì‚°": "ê²½ë‚¨","ì˜ë ¹êµ°": "ê²½ë‚¨","ì˜ë ¹": "ê²½ë‚¨","í•¨ì•ˆêµ°": "ê²½ë‚¨","í•¨ì•ˆ": "ê²½ë‚¨","ì°½ë…•êµ°": "ê²½ë‚¨","ì°½ë…•": "ê²½ë‚¨","ê³ ì„±êµ°": "ê²½ë‚¨","ê³ ì„±": "ê²½ë‚¨",
    "ë‚¨í•´êµ°": "ê²½ë‚¨","ë‚¨í•´": "ê²½ë‚¨","í•˜ë™êµ°": "ê²½ë‚¨","í•˜ë™": "ê²½ë‚¨","ì‚°ì²­êµ°": "ê²½ë‚¨","ì‚°ì²­": "ê²½ë‚¨","í•¨ì–‘êµ°": "ê²½ë‚¨","í•¨ì–‘": "ê²½ë‚¨","ê±°ì°½êµ°": "ê²½ë‚¨","ê±°ì°½": "ê²½ë‚¨","í•©ì²œêµ°": "ê²½ë‚¨","í•©ì²œ": "ê²½ë‚¨",

    # ì œì£¼
    "ì œì£¼ì‹œ": "ì œì£¼","ì œì£¼": "ì œì£¼","ì„œê·€í¬ì‹œ": "ì œì£¼","ì„œê·€í¬": "ì œì£¼",

    # ì„œìš¸
    "ê°•ë‚¨êµ¬": "ì„œìš¸","ê°•ë‚¨": "ì„œìš¸", "ê°•ë™êµ¬": "ì„œìš¸","ê°•ë™": "ì„œìš¸", "ê°•ë¶êµ¬": "ì„œìš¸","ê°•ë¶": "ì„œìš¸", "ê°•ì„œêµ¬": "ì„œìš¸","ê°•ì„œ": "ì„œìš¸",
    "ê´€ì•…êµ¬": "ì„œìš¸","ê´€ì•…": "ì„œìš¸", "ê´‘ì§„êµ¬": "ì„œìš¸","ê´‘ì§„": "ì„œìš¸", "êµ¬ë¡œêµ¬": "ì„œìš¸","êµ¬ë¡œ": "ì„œìš¸", "ê¸ˆì²œêµ¬": "ì„œìš¸","ê¸ˆì²œ": "ì„œìš¸",
    "ë…¸ì›êµ¬": "ì„œìš¸","ë…¸ì›": "ì„œìš¸", "ë„ë´‰êµ¬": "ì„œìš¸","ë„ë´‰": "ì„œìš¸", "ë™ëŒ€ë¬¸êµ¬": "ì„œìš¸","ë™ëŒ€ë¬¸": "ì„œìš¸", "ë™ì‘êµ¬": "ì„œìš¸","ë™ì‘": "ì„œìš¸",
    "ë§ˆí¬êµ¬": "ì„œìš¸","ë§ˆí¬": "ì„œìš¸", "ì„œëŒ€ë¬¸êµ¬": "ì„œìš¸","ì„œëŒ€ë¬¸": "ì„œìš¸", "ì„œì´ˆêµ¬": "ì„œìš¸","ì„œì´ˆ": "ì„œìš¸", "ì„±ë™êµ¬": "ì„œìš¸","ì„±ë™": "ì„œìš¸",
    "ì„±ë¶êµ¬": "ì„œìš¸","ì„±ë¶": "ì„œìš¸", "ì†¡íŒŒêµ¬": "ì„œìš¸","ì†¡íŒŒ": "ì„œìš¸", "ì–‘ì²œêµ¬": "ì„œìš¸","ì–‘ì²œ": "ì„œìš¸", "ì˜ë“±í¬êµ¬": "ì„œìš¸","ì˜ë“±í¬": "ì„œìš¸",
    "ìš©ì‚°êµ¬": "ì„œìš¸","ìš©ì‚°": "ì„œìš¸", "ì€í‰êµ¬": "ì„œìš¸","ì€í‰": "ì„œìš¸", "ì¤‘ë‘êµ¬": "ì„œìš¸","ì¤‘ë‘": "ì„œìš¸",

    # ê´‘ì—­ì‹œ í•˜ìœ„ êµ¬Â·êµ°
    "ë‹¬ì„±êµ°": "ëŒ€êµ¬", "ë‹¬ì„±": "ëŒ€êµ¬","ë‹¬ì„œêµ¬": "ëŒ€êµ¬", "ë‹¬ì„œ": "ëŒ€êµ¬","ìˆ˜ì„±êµ¬": "ëŒ€êµ¬", "ìˆ˜ì„±": "ëŒ€êµ¬",
    "í•´ìš´ëŒ€êµ¬": "ë¶€ì‚°", "í•´ìš´ëŒ€": "ë¶€ì‚°","ê¸ˆì •êµ¬": "ë¶€ì‚°","ê¸ˆì •": "ë¶€ì‚°", "ê¸°ì¥êµ°": "ë¶€ì‚°","ê¸°ì¥": "ë¶€ì‚°","ë™ë˜êµ¬": "ë¶€ì‚°","ë™ë˜": "ë¶€ì‚°","ë¶€ì‚°ì§„êµ¬": "ë¶€ì‚°","ì‚¬ìƒêµ¬": "ë¶€ì‚°","ì‚¬ìƒ": "ë¶€ì‚°","ì‚¬í•˜êµ¬": "ë¶€ì‚°","ì‚¬í•˜": "ë¶€ì‚°", 
    "ìˆ˜ì˜êµ¬": "ë¶€ì‚°","ìˆ˜ì˜": "ë¶€ì‚°","ì—°ì œêµ¬": "ë¶€ì‚°","ì—°ì œ": "ë¶€ì‚°","ì˜ë„êµ¬": "ë¶€ì‚°","ì˜ë„": "ë¶€ì‚°",
    "ê´‘ì‚°êµ¬": "ê´‘ì£¼","ê´‘ì‚°": "ê´‘ì£¼","ëŒ€ë•êµ¬": "ëŒ€ì „","ëŒ€ë•": "ëŒ€ì „","ìœ ì„±êµ¬": "ëŒ€ì „","ìœ ì„±": "ëŒ€ì „", "ìš¸ì£¼êµ°": "ìš¸ì‚°","ìš¸ì£¼": "ìš¸ì‚°",

    # ëª¨í˜¸ â†’ ì „êµ­ ì²˜ë¦¬ í•„ìš”
    "ì¤‘êµ¬": "ì „êµ­","ë‚¨êµ¬": "ì „êµ­","ë™êµ¬": "ì „êµ­","ì„œêµ¬": "ì „êµ­","ë¶êµ¬": "ì „êµ­"
}

AMBIGUOUS_NAMES = {"ì¤‘êµ¬", "ë‚¨êµ¬", "ë™êµ¬", "ì„œêµ¬", "ë¶êµ¬"}

# ---------------- extract_region ----------------
def extract_region(agency_name: str):
    if not agency_name:
        return "ì „êµ­", "ì „êµ­"

    # 1) ì‹œ/ë„ëª… ì§ì ‘ í¬í•¨
    for keyword, sido in REGION_KEYWORDS.items():
        if keyword in agency_name:
            return sido, keyword if keyword not in AMBIGUOUS_NAMES else "ì „êµ­"

    # 2) â—‹â—‹ì‹œ/êµ°/êµ¬ ì¶”ì¶œ
    match = re.search(r"([ê°€-í£]{2,}(ì‹œ|êµ°|êµ¬))", agency_name)
    if match:
        sigungu = match.group(1)
        if sigungu in AMBIGUOUS_NAMES:
            return "ì „êµ­", sigungu
        return REGION_KEYWORDS.get(sigungu, "ì „êµ­"), sigungu

    # 3) ê¸°ê´€ëª… ì „ì²´ì—ì„œ ë‘ ê¸€ì ì´ìƒ í‚¤ì›Œë“œ íƒìƒ‰
    for keyword, sido in REGION_KEYWORDS.items():
        if len(keyword) >= 2 and keyword in agency_name:
            if keyword in AMBIGUOUS_NAMES:
                return "ì „êµ­", "ì „êµ­"
            return sido, keyword

    # 4) ê¸°ë³¸ê°’
    return "ì „êµ­", "ì „êµ­"

# ---------------- detect_region_from_target (ì§€ì›ëŒ€ìƒ ë³´ì¡°) ----------------
def detect_region_from_target(target_text: str):
    if not target_text:
        return None
    for keyword, sido in REGION_KEYWORDS.items():
        if keyword in target_text:
            return sido
    return None

# ---------------- extract_region_with_target (ë³´ì™„íŒ) ----------------
def extract_region_with_target(agency_name: str, target_text: str):
    region_sido, region_sigungu = extract_region(agency_name)

    # ë³´ì™„ ë¡œì§: ì „êµ­ ë˜ëŠ” ë§¤í•‘ ì‹¤íŒ¨ì¼ ë•Œ ì§€ì›ëŒ€ìƒìœ¼ë¡œ ë³´ì •
    if region_sido == "ì „êµ­" or not region_sido:
        target_region = detect_region_from_target(target_text)
        if target_region:
            region_sido = target_region

    return region_sido, region_sigungu

# ---------------- merge_and_save ----------------
def merge_and_save():
    print("âœ… ì„œë¹„ìŠ¤ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...")
    service_list = fetch_all_data("serviceList")
    print(f"ğŸ‘‰ ì´ {len(service_list)}ê±´ ë¶ˆëŸ¬ì˜´")

    print("âœ… ìƒì„¸ ë‚´ìš© ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...")
    detail_list = fetch_all_data("serviceDetail")

    print("âœ… ì¡°ê±´ ì •ë³´ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...")
    condition_list = fetch_all_data("supportConditions")

    print("âœ… ë³‘í•© ì¤‘...")
    detail_map = {d["ì„œë¹„ìŠ¤ID"]: d for d in detail_list if "ì„œë¹„ìŠ¤ID" in d}
    condition_map = {c["ì„œë¹„ìŠ¤ID"]: c for c in condition_list if "ì„œë¹„ìŠ¤ID" in c}

    merged = []
    for s in tqdm(service_list):
        sid = s.get("ì„œë¹„ìŠ¤ID", "")
        detail = detail_map.get(sid, {})
        condition = condition_map.get(sid, {})

       # ìˆ˜ì • í¬ì¸íŠ¸: ì§€ì›ëŒ€ìƒ ë³´ì • ë¡œì§ ì ìš©
        region_sido, region_sigungu = extract_region_with_target(
            s.get("ì†Œê´€ê¸°ê´€ëª…", ""),
            s.get("ì§€ì›ëŒ€ìƒ", "")
        )

        record = {
            "id": sid,
            "name": s.get("ì„œë¹„ìŠ¤ëª…", ""),
            "purpose": s.get("ì„œë¹„ìŠ¤ëª©ì ìš”ì•½", ""),
            "target": s.get("ì§€ì›ëŒ€ìƒ", ""),
            "criteria": s.get("ì„ ì •ê¸°ì¤€", ""),
            "details": s.get("ì§€ì›ë‚´ìš©", ""),
            "applyMethod": s.get("ì‹ ì²­ë°©ë²•", ""),
            "deadline": s.get("ì‹ ì²­ê¸°í•œ", ""),
            "viewCount": s.get("ì¡°íšŒìˆ˜", 0),
            "agency": s.get("ì†Œê´€ê¸°ê´€ëª…", ""),
            "department": s.get("ë¶€ì„œëª…", ""),
            "userType": s.get("ì‚¬ìš©ìêµ¬ë¶„", ""),
            "serviceField": s.get("ì„œë¹„ìŠ¤ë¶„ì•¼", ""),
            "applyUrl": s.get("ìƒì„¸ì¡°íšŒURL", ""),
            "phone": s.get("ì „í™”ë¬¸ì˜", ""),
            "registerDate": s.get("ë“±ë¡ì¼ì‹œ", ""),
            "updateDate": s.get("ìˆ˜ì •ì¼ì‹œ", ""),
            "fullPurpose": detail.get("ì„œë¹„ìŠ¤ëª©ì ", ""),
            "requiredDocs": detail.get("êµ¬ë¹„ì„œë¥˜", ""),
            "receptionOrg": detail.get("ì ‘ìˆ˜ê¸°ê´€ëª…", ""),
            "onlineUrl": detail.get("ì˜¨ë¼ì¸ì‹ ì²­ì‚¬ì´íŠ¸URL", ""),
            "law": detail.get("ë²•ë ¹", ""),
            "condition": condition,
            "regionSido": region_sido,
            "regionSigungu": region_sigungu
        }
        merged.append(record)

    output_path = "C:/Users/admin/Documents/GitHub/benefitmatch/benefits.json.gz"
    with gzip.open(output_path, "wt", encoding="utf-8") as f:
        json.dump(merged, f, ensure_ascii=False)

    print(f"ğŸ‰ ì´ {len(merged)}ê±´ ì €ì¥ ì™„ë£Œ â†’ {output_path} (gzip ì••ì¶•)")

# ---------------- main ----------------
if __name__ == "__main__":
    merge_and_save()
